server {
    listen 80;
    server_name am.test;
    
    # Custom error log for this server block
    error_log /var/log/nginx/am.error.log;
    access_log /var/log/nginx/am.access.log;

    # Backend API routes
    location /api {
        proxy_pass http://localhost:8000;
        proxy_http_version  1.1;
        proxy_set_header    Host               $host;
        proxy_set_header    X-Real-IP          $remote_addr;
        proxy_set_header    X-Forwarded-For    $proxy_add_x_forwarded_for;
        proxy_set_header    Connection         "upgrade";
    }

    # Laravel authentication and specific routes
    location ~ ^/(register|login|logout|auto-login|profile|file|generator|forgot-password|reset-password|verify-email|confirm-password|invitation|email) {
        proxy_pass http://localhost:8000;
        proxy_http_version  1.1;
        proxy_set_header    Host               $host;
        proxy_set_header    X-Real-IP          $remote_addr;
        proxy_set_header    X-Forwarded-For    $proxy_add_x_forwarded_for;
        proxy_set_header    Connection         "upgrade";
    }

    # Frontend routes - serve Vue.js application
    location ~ ^/(test|testGenerator|logo\.svg|assets|sample|p|dashboard|users|organizations|programs|settings|files|customerPrograms|products|pdfjs|address-book|layouts|importData|selenium) {
        proxy_pass http://localhost:3000;
        proxy_http_version  1.1;
        proxy_set_header    Host               $host;
        proxy_set_header    X-Real-IP          $remote_addr;
        proxy_set_header    X-Forwarded-For    $proxy_add_x_forwarded_for;
        proxy_set_header    Connection         "upgrade";
    }

    # Default fallback - serve Vue.js for SPA routing
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version  1.1;
        proxy_set_header    Host               $host;
        proxy_set_header    X-Real-IP          $remote_addr;
        proxy_set_header    X-Forwarded-For    $proxy_add_x_forwarded_for;
        proxy_set_header    Connection         "upgrade";
    }
}
